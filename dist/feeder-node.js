!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FeederNode=t():e.FeederNode=t()}(self,(function(){return(()=>{"use strict";var e={809:(e,t,n)=>{function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,{default:()=>H});var o={UNINITIALIZED:1,READY:2,PLAYING:3,STARVED:4};Object.freeze(o);var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"feed",value:function(e){throw"feed() must be implemented"}},{key:"connect",value:function(e){throw"connect() must be implemented"}},{key:"disconnect",value:function(){throw"disconnect() must be implemented"}}])&&r(t.prototype,n),e}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32768,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(i(this,e),this._data=[],this._writePos=0,this._readPos=0,t<=0)throw"bufferLength must be >= 1";if(!(0<n&&n<=2))throw"nChannels must be 0 < nChannels <=2";for(var r=0;r<n;r++)this._data.push(new Float32Array(t));this.bufferLength=t,this._nChannels=n}var t,n;return t=e,(n=[{key:"hasDataAvailable",value:function(){return this._writePos!=this._readPos}},{key:"resetReadPosition",value:function(){this._readPos=this._writePos}},{key:"getNReadableSamples",value:function(){return this._readPos==this._writePos?0:this._readPos<this._writePos?this._writePos-this._readPos:this.bufferLength-this._readPos+this._writePos}},{key:"advanceReadPosition",value:function(e){for(var t=this._readPos,n=0;n<e&&(t==this.bufferLength&&(t=0),++t!=this._writePos);n++);this._readPos=t}},{key:"read",value:function(e){for(var t,n=Array.apply(null,Array(this._nChannels)).map((function(t,n){return new Float32Array(e)})),r=Math.min(e,this.getNReadableSamples()),o=0;o<n.length;o++){var a=n[o];t=this._readPos;for(var i=0;i<r;i++)t==this.bufferLength&&(t=0),a[i]=this._data[o][t++]}return this._readPos=t,n}},{key:"readInto",value:function(e,t){for(var n,r=Math.min(t,this.getNReadableSamples()),o=0;o<e.length;o++){n=this._readPos;for(var a=0;a<r;a++)n==this.bufferLength&&(n=0),e[o][a]=this._data[o][n++]}this._readPos=n}},{key:"_resize",value:function(e){for(var t=[],n=this.getNReadableSamples(),r=0;r<this._nChannels;r++)t.push(new Float32Array(e));this.readInto(t,n),this._writePos=n,this._readPos=0,this._data=t,this.bufferLength=t[0].length}},{key:"write",value:function(e){var t,n,r=!1,o=!1;if(ArrayBuffer.isView(e)&&1===this._nChannels)t=[e];else if(ArrayBuffer.isView(e))t=[e],r=!0;else{if(e.length!=this._nChannels)throw"readChannels.length must equal this._nChannels!";for(var a=e[0].length,i=0;i<e.length;i++)if(e[i].length!=a)throw"channel lengths differ in write()";t=e}(r?t[0].length/this._data.length:t[0].length)>this.bufferLength&&(this._resize(t[0].length+this.getNReadableSamples()),o=!0);for(var u=0;u<t.length;u++){var s=t[u];if(n=this._writePos,!0===r)for(var c=0;c<s.length;c+=this._data.length){n==this.bufferLength&&(n=0);for(var f=0;f<this._data.length;f++)this._data[f][n]=s[c+f];n++}else for(var l=0;l<s.length;l++)n==this.bufferLength&&(n=0),this._data[u][n++]=s[l]}return this._writePos=n,[o,this.bufferLength]}}])&&u(t.prototype,n),e}();function c(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(404===r.status?(console.error("Unable to find file at ".concat(e,". You can change this url using the FeederNode constructor options arg")),n()):t())},r.open("GET",e,!0),r.send()}))}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(u,e);var t,n,r,a,i=(r=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(r);if(a){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function u(e,t,n,r,a,c,f){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(l=i.call(this)).batchSize=t,l.nChannels=n,l.bufferThreshold=a,l._stateChangeCb=c,l._processor=e.createScriptProcessor(l.batchSize,0,l.nChannels),l._processor.onaudioprocess=l._playNext.bind(y(l)),l._buffer=new s(r,l.nChannels),l.state=o.READY,l}return t=u,(n=[{key:"feed",value:function(e){this._buffer.write(e)}},{key:"_updateState",value:function(){var e=this.state;switch(this.state){case o.UNINITIALIZED:return;case o.PLAYING:0===this._buffer.getNReadableSamples()&&(this.state=o.STARVED);break;case o.READY:case o.STARVED:this._buffer.getNReadableSamples()>=this.bufferThreshold&&(this.state=o.PLAYING)}e!=this.state&&this._notifyStateChange()}},{key:"_notifyStateChange",value:function(){this._stateChangeCb(this.state)}},{key:"connect",value:function(e){this._processor.connect(e)}},{key:"disconnect",value:function(){this._processor.disconnect()}},{key:"_playNext",value:function(e){this._updateState();var t=Array.apply(null,Array(this.nChannels)).map((function(t,n){return e.outputBuffer.getChannelData(n)}));this.state===o.PLAYING?this._buffer.readInto(t,this.batchSize):function(e){for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.length;r++)n[r]=0}(t)}},{key:"bufferLength",get:function(){return this._buffer.bufferLength}}])&&l(t.prototype,n),u}(a);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e){var t="function"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return m(e,arguments,A(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),S(r,e)})(e)}function m(e,t,n){return(m=R()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&S(o,n.prototype),o}).apply(null,arguments)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e){var t=R();return function(){var n,r=A(e);if(t){var o=A(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return C(this,n)}}function C(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(e){k(a,e);var t,n,r=P(a);function a(e,t,n,i,u,s,c,f){var l;return w(this,a),(l=r.call(this)).context=e,l.nChannels=n,l.bufferLength=i,l.bufferThreshold=u,l._stateChangeCb=s,l.pathToWorkletProcessor=f,l.port=c,l.state=o.UNINITIALIZED,128!=t&&console.warn("Batch size ".concat(t," requested, but AudioWorklets are hardcoded to 128")),l}return t=a,(n=[{key:"feed",value:function(e){this.audioNode.port.postMessage({command:"feed",data:e},[e.buffer])}},{key:"_onMessage",value:function(e){if("bufferLengthChange"===e.data.command)this.bufferLength=e.data.bufferLength;else{if("stateChange"!==e.data.command)throw"command ".concat(e.data.command," unrecognized");this._stateChangeCb(e.data.state)}}},{key:"connect",value:function(e){var t=this,n=this.nChannels,r=function(e){k(r,e);var t=P(r);function r(e){return w(this,r),t.call(this,e,"FeederNode",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[n]})}return r}(g(AudioWorkletNode));this.context.audioWorklet.addModule(this.pathToWorkletProcessor).then((function(){t.audioNode=new r(t.context),t.audioNode.connect(e),t.audioNode.port.postMessage({command:"init",nChannels:t.nChannels,bufferLength:t.bufferLength,bufferThreshold:t.bufferThreshold}),t.audioNode.port.onmessage=t._onMessage.bind(t),void 0!==t.port&&t.audioNode.port.postMessage({command:"connect"},[t.port])}))}},{key:"disconnect",value:function(){this.audioNode&&this.audioNode.disconnect()}}])&&_(t.prototype,n),a}(a);function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inputSampleRate=t,this.outputSampleRate=n,this._onProcessedCallback=r}var t,n;return t=e,(n=[{key:"processBatch",value:function(e){throw new Error("processBatch must be overridden!")}}])&&j(t.prototype,n),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inputSampleRate=t,this.outputSampleRate=n,this.nChannels=r,this._resampleFractional=0,this._resampleLastSampleData=void 0}var t,n;return t=e,(n=[{key:"resample",value:function(e){var t=this.inputSampleRate,n=this.nChannels,r=this.outputSampleRate;if(t==r)return e;var o,a=[],i=e[0].length,u=this._resampleFractional,s=i*r/t+u,c=Math.floor(s),f=s-c;o=t<r?function(e,n,o,a){for(var i=function(t){return t<0?o&&o.length+t>0?o[o.length+t]:e[0]:e[t]},s=0;s<n.length;s++){var c,f=(s+1-u)*t/r-1,l=Math.floor(f),h=Math.ceil(f);c=l==h?i(l):i(l)*(h-f)+i(h)*(f-l),n[s]=c}}:function(e,t,n){for(var r=0;r<t.length;r++)t[r]=e[r*e.length/t.length|0]};for(var l=0;l<n;l++){var h=l,p=e[h],y=new Float32Array(c);o(p,y,this._resampleLastSampleData?this._resampleLastSampleData[h]:void 0),a.push(y)}return this._resampleFractional=f,this._resampleLastSampleData=e,a}}])&&E(t.prototype,n),e}();function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(i,e);var t,n,r,o,a=(r=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=B(r);if(o){var n=B(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function i(e,t,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(o=a.call(this,e,t,r)).nChannels=n,o.inputChannelBuffers=Array.apply(null,Array(n)).map((function(e,t){return new Float32Array(192e3)})),o._resampler=new L(e,t,n),o}return t=i,(n=[{key:"processBatch",value:function(e){if(this.inputSampleRate===this.outputSampleRate)return this._onProcessedCallback(e);var t=e.length/this.nChannels;t>this.inputChannelBuffers[0].length&&(this.inputChannelBuffers=Array.apply(null,Array(this.nChannels)).map((function(e,n){return new Float32Array(t)}))),function(e,t){if(e.length>t[0].length*t.length)throw"incorrect channel lengths";for(var n=0;n<t.length;n++)for(var r=n,o=0;o<t[n].length;o++)t[n][o]=e[r],r+=t.length}(e,this.inputChannelBuffers);var n,r,o,a=this.inputChannelBuffers.map((function(e){return new Float32Array(e.buffer,0,t)})),i=(n=this._resampler.resample(a),r=n[0].length*n.length,o=new Float32Array(r),function(e,t){if(t.length<e[0].length*e.length)throw Error("incorrect channel lengths");for(var n=0,r=0;r<e[0].length;r++)for(var o=0;o<e.length;o++)t[n++]=e[o][r]}(n,o),o);this._onProcessedCallback(i)}}])&&I(t.prototype,n),i}(T);function M(){return new Worker(n.p+"feeder-node.worker.js")}function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Y(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?V(e):t}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(i,e);var t,n,r,o,a=(r=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(r);if(o){var n=G(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Y(this,e)});function i(e,t,n,r,o,u){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(s=a.call(this,e,t,r)).worker=new M,s.worker.onmessage=s._onMessage.bind(V(s)),s.worker.postMessage({command:"init",inputSampleRate:e,outputSampleRate:t,nChannels:n}),void 0!==o&&s.worker.postMessage({command:"connect"},[o]),s}return t=i,(n=[{key:"processBatch",value:function(e){this.worker.postMessage({command:"feed",data:e},[e.buffer])}},{key:"_onMessage",value:function(e){this._onProcessedCallback(e.data)}}])&&U(t.prototype,n),i}(T);function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Z(this,e),this.context=t;var r,o,a=void 0===n.resampleAsync||n.resampleAsync,i=n.batchSize||(void 0!==window.AudioWorklet?128:512),u=n.bufferThreshold||4096,s=n.nChannels||2,f=n.bufferLength||192e3,l=n.pathToWorkletProcessor||"/feeder-node.processor.js",h=n.pathToWorker||"/feeder-node.worker.js";this.inputSampleRate=n.inputSampleRate||t.sampleRate,this.outputSampleRate=t.sampleRate,this.messageChannel={port1:void 0,port2:void 0},a&&void 0!==window.AudioWorklet&&(this.messageChannel=new MessageChannel),a?(c(h),r=q):r=F,this._resampler=new r(this.inputSampleRate,this.outputSampleRate,s,this._onResampleComplete.bind(this),this.messageChannel.port1,h),void 0!==window.AudioWorklet?(c(l),o=O):o=b,this._backend=new o(t,i,s,f,u,this._onBackendStateChange.bind(this),this.messageChannel.port2,l)}var t,n;return t=e,(n=[{key:"connect",value:function(e){this._backend.connect(e)}},{key:"disconnect",value:function(){this._backend.disconnect()}},{key:"feed",value:function(e){var t;if(!ArrayBuffer.isView(e))throw Error("FeederNode.feed() must receive an instance of TypedArray. You passed ".concat(e.constructor));t=function(e){var t=function(e){switch(e.constructor){case Float32Array:return 1;case Int8Array:case Uint8Array:return 127;case Int16Array:case Uint16Array:return 32767;case Int32Array:case Uint32Array:return 2147483647;default:throw"Unsupport data type ".concat(e.constructor)}}(e),n=new Float32Array(e.length);switch(e.constructor){case Float32Array:return e;case Int8Array:case Int16Array:case Int32Array:for(var r=0;r<e.length;r++)n[r]=e[r]/t;break;case Uint8Array:case Uint16Array:case Uint32Array:for(var o=0;o<e.length;o++)n[o]=(e[o]-t)/t}return n}(e),this._resampler.processBatch(t)}},{key:"onBackendReady",value:function(){}},{key:"onBackendPlaying",value:function(){}},{key:"onBackendStarved",value:function(){}},{key:"_onResampleComplete",value:function(e){this._backend.feed(e)}},{key:"_onBackendStateChange",value:function(e){switch(e){case o.READY:return this.onBackendReady();case o.PLAYING:return this.onBackendPlaying();case o.STARVED:return this.onBackendStarved();default:throw"unknown state ".concat(e)}}},{key:"bufferLength",get:function(){return this._backend.bufferLength}},{key:"nChannels",get:function(){return this._backend.nChannels}},{key:"batchSize",get:function(){return this._backend.batchSize}}])&&$(t.prototype,n),e}()}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n(809)})().default}));